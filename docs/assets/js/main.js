"use strict";let seriesAnime=[],favouriteSeriesAnime=JSON.parse(localStorage.getItem("favourites"))||[];const apiUrl="https://api.jikan.moe/v3/search/anime",listSeries=document.querySelector(".js-list-series"),listSeriesFavourite=document.querySelector(".js-list-series-favourite"),inputSearch=document.querySelector(".js-search_series"),btnSearch=document.querySelector(".js-btn-search"),btnReset=document.querySelector(".js-btn-reset-search"),btnResetFav=document.querySelector(".js-favourites__btn-reset");function setLocalStorage(){localStorage.setItem("favourites",JSON.stringify(favouriteSeriesAnime))}function getUrlImg(e){return e.image_url||"https://via.placeholder.com/210x295/ffffff/666666/?text=TV"}function getHtmlSerie(e){const t=getUrlImg(e);let i=`<li class="serie js-selectorSeriesFavourites" data-id="${e.mal_id}">`;return i+=`  <h2 class="serie__title">${e.title}</h2>`,i+=`  <img class="serie__img js-img-series" src="${t}"`,i+='    alt="no existe imagen">',i+="</li>",i}function getHtmlSerieFavourite(e){const t=getUrlImg(e);let i='<li class="serie-favourite">';return i+=`  <h2 class="serie-favourite__title">${e.title} <span class="delete-fav js-deleteFav" data-id="${e.mal_id}">x</span></h2>`,i+=`  <img class="serie-favourite__img js-img-series" src="${t}"`,i+='    alt="no existe imagen">',i+="</li>",i}function paintListSeries(){if(listSeries.innerHTML="",seriesAnime)for(let e=0;e<seriesAnime.length;e++){const t=seriesAnime[e];listSeries.innerHTML+=getHtmlSerie(t)}else listSeries.innerHTML="Serie no encontrada, prueba con otra";listenAddSerie()}function paintListFavouriteSeries(){listSeriesFavourite.innerHTML="";for(let e=0;e<favouriteSeriesAnime.length;e++){const t=favouriteSeriesAnime[e];listSeriesFavourite.innerHTML+=getHtmlSerieFavourite(t)}listenRemoveFavourite()}function listenAddSerie(){const e=document.querySelectorAll(".js-selectorSeriesFavourites");for(let t=0;t<e.length;t++){e[t].addEventListener("click",addSeriesFavourite)}}function listenRemoveFavourite(){const e=document.querySelectorAll(".js-deleteFav");for(let t=0;t<e.length;t++){e[t].addEventListener("click",removeSeriesFavourites)}}function addSeriesFavourite(e){const t=parseInt(e.currentTarget.dataset.id),i=seriesAnime.find(e=>e.mal_id===t),r=favouriteSeriesAnime.find(e=>e.mal_id===t);e.currentTarget.classList.add("now-favourite"),void 0===r&&favouriteSeriesAnime.push({title:i.title,mal_id:i.mal_id,image_url:i.image_url}),setLocalStorage(),paintListFavouriteSeries()}function removeSeriesFavourites(e){const t=parseInt(e.currentTarget.dataset.id),i=favouriteSeriesAnime.findIndex(e=>e.mal_id===t);i>=0&&favouriteSeriesAnime.splice(i,1),setLocalStorage(),paintListFavouriteSeries()}function searchSeries(e){e.preventDefault();const t=inputSearch.value;fetch(`${apiUrl}?q=${t}`).then(e=>e.json()).then(e=>{seriesAnime=e.results,paintListSeries()})}function handleClickReset(){seriesAnime=[],inputSearch.value="",paintListSeries()}function handleClickResetFav(){favouriteSeriesAnime=[],setLocalStorage(),paintListFavouriteSeries()}btnSearch.addEventListener("click",searchSeries),btnReset.addEventListener("click",handleClickReset),btnResetFav.addEventListener("click",handleClickResetFav),paintListFavouriteSeries();